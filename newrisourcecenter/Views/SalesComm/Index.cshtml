@model List<newrisourcecenter.Models.SalesCommunicationsViewModel>
@{
    string userProducts = Convert.ToString(Session["userProducts"]);
    string companyType = Convert.ToString(Session["companyType"]);
    string userIndustry = Convert.ToString(Session["userIndustry"]);
    string audience = Convert.ToString(Session["companyType"]);
}
<script>
    var communications = {
        init: function () {
            var filter_form = $("#submit_search");

            $("a").click(function (event) {
                $("#sc_body_" + event.target.id).toggleClass("show_sales_comm");
                $("#sc_teaser_" + event.target.id).toggleClass("show_sales_comm");

                if ($("#sc_teaser_" + event.target.id).hasClass("show_sales_comm")) {
                    $("#" + event.target.id).css("color", "#5f5b5b");
                    $("#sc_body_" + event.target.id).css("padding", "10px");
                    $("#sc_body_" + event.target.id).css("box-shadow", "#696969 -1px 3px 3px 3px");
                    $("#toggle_" + event.target.id).attr("class", "glyphicon glyphicon-circle-arrow-up");
                } else {
                    $("#" + event.target.id).css("color", "#e21785");
                    $("#toggle_" + event.target.id).attr("class", "glyphicon glyphicon-circle-arrow-down");
                }
            });
        },
    }
    jQuery(document).ready(communications.init);
    function changeData(date) {
        var url = location.href;
        if (url.indexOf("&recent=") !== -1) {
            url = url.replace("&recent=latest","");
            url = url.replace("&recent=all", "");
        }
        location.href = url + "&recent="+ date;
    }
</script>
<div class="main_content">
    <div>
        <div id="dropdown">
            <div class="dropdown" style="text-align:left;">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                    Filter by Category
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    @foreach (var items in Model)
                    {
                        if (@items.sales_submenu != null)
                        {
                            foreach (var item in items.sales_submenu)
                            {
                                <li><a href="?parentID=1&childId=@item.n2Id&n1_name=@Request.QueryString["n1_name"]&n2_name=@item.n2_longName&querystring=@Request.QueryString["querystring"]&submenu=yes">@item.n2_longName</a></li>
                            }
                        }
                    }
                </ul>
            </div>
        </div>
        <div id="dropdown" style="float:left;margin-right:30px;">
            <form method="get">
                <span class="input-group stylish-input-group" style="width:300px;">
                    <input type="text" name="querystring" value="" placeholder="search..." class="form-control" />
                    <input type="hidden" name="n1_name" value="@Request.QueryString["n1_name"]" />
                    @if (@Request.QueryString["n3id"] != null)
                    {
                        <input type="hidden" name="n3id" value="@Request.QueryString["n3id"]" />
                    }
                    @if (@Request.QueryString["childId"] != null)
                    {
                        <input type="hidden" name="childId" value="@Request.QueryString["childId"]" />
                    }
                    @if (@Request.QueryString["n2_name"] != null)
                    {
                        <input type="hidden" name="n2_name" value="@Request.QueryString["n2_name"]" />
                    }
                    @if (@Request.QueryString["n3_name"] != null)
                    {
                        <input type="hidden" name="n3_name" value="@Request.QueryString["n3_name"]" />
                    }
                    <input type="hidden" name="submenu" value="@Request.QueryString["submenu"]" />
                    <span class="input-group-addon" id="submit_search">
                        <button type="submit">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </span>
                </span>
            </form>
        </div>
    </div>
    <div align="center" style="margin:20px;">
        @if (!string.IsNullOrEmpty(Request.QueryString["querystring"]))
        {
            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] != "yes")
            {
                <span class="btn btn-info btn-sm" style="color:blue;">
                    Searched: @Request.QueryString["querystring"]
                    <a href="~/SalesComm/?parentID=1&n3id=@Request.QueryString["n3id"]&childId=@Request.QueryString["childId"]&n1_name=@Request.QueryString["n1_name"]&n2_name=@Request.QueryString["n2_name"]&n3_name=@Request.QueryString["n3_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] == null && Request.QueryString["submenu"] == "yes")
            {
                <span class="btn btn-info btn-sm" style="color:blue;">
                    Searched: @Request.QueryString["querystring"]
                    <a href="?parentID=1&n3id=@Request.QueryString["n3id"]&n1_name=@Request.QueryString["n1_name"]&n3_name=@Request.QueryString["n3_name"]&submenu=yes"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] == null && Request.QueryString["childId"] != null)
            {
                <span class="btn btn-info btn-sm" style="color:blue;">
                    Searched: @Request.QueryString["querystring"]
                    <a href="~/SalesComm/?parentID=1&childId=@Request.QueryString["childId"]&n1_name=@Request.QueryString["n1_name"]&n2_name=@Request.QueryString["n2_name"]&submenu=yes"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] == null && Request.QueryString["childId"] == null)
            {
                <span class="btn btn-info btn-sm" style="color:blue;">
                    Searched: @Request.QueryString["querystring"]
                    <a href="~/SalesComm/?n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] != "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n2_name"]
                    <a href="?parentID=1&n3id=@Request.QueryString["n3id"]&querystring=@Request.QueryString["querystring"]&n1_name=@Request.QueryString["n1_name"]&n3_name=@Request.QueryString["n3_name"]&submenu=yes"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] != "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n3_name"]
                    <a href="?parentID=1&childId=@Request.QueryString["childId"]&querystring=@Request.QueryString["querystring"]&n1_name=@Request.QueryString["n1_name"]&n2_name=@Request.QueryString["n2_name"]&submenu=yes"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] == null && Request.QueryString["submenu"] == "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n3_name"]
                    <a href="~/SalesComm/?querystring=@Request.QueryString["querystring"]&n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] == null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] == "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n2_name"]
                    <a href="~/SalesComm/?querystring=@Request.QueryString["querystring"]&n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["childId"] != null && Request.QueryString["n3id"] == null && Request.QueryString["submenu"] != "yes" && Request.QueryString["n2_name"] == null)
            {
                <span class="btn btn-info btn-sm">
                    @ViewBag.n2Name
                    <a href="~/SalesComm/?querystring=@Request.QueryString["querystring"]&n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["parentID"] != null)
            {
                <a class="btn btn-info btn-sm" id="reset" href="~/SalesComm/?&n1_name=@Request.QueryString["n1_name"]">Reset</a>
            }
        }
        else
        {
            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] != "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n2_name"]
                    <a href="?parentID=1&n3id=@Request.QueryString["n3id"]&n1_name=@Request.QueryString["n1_name"]&n3_name=@Request.QueryString["n3_name"]&submenu=yes"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] != "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n3_name"]
                    <a href="?parentID=1&childId=@Request.QueryString["childId"]&n1_name=@Request.QueryString["n1_name"]&n2_name=@Request.QueryString["n2_name"]&submenu=yes"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] != null && Request.QueryString["childId"] == null && Request.QueryString["submenu"] == "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n3_name"]
                    <a href="~/SalesComm/?n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["n3id"] == null && Request.QueryString["childId"] != null && Request.QueryString["submenu"] == "yes")
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["n2_name"]
                    <a href="~/SalesComm/?n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["childId"] != null && Request.QueryString["n3id"] == null && Request.QueryString["submenu"] != "yes" && Request.QueryString["n2_name"] == null)
            {
                <span class="btn btn-info btn-sm">
                    @ViewBag.n2Name
                    <a href="~/SalesComm/?&n1_name=@Request.QueryString["n1_name"]"> X </a>
                </span>
            }

            if (Request.QueryString["recent"] != null)
            {
                <span class="btn btn-info btn-sm">
                    @Request.QueryString["recent"].ToUpperInvariant()
                </span>
            }

            if (Request.QueryString["parentID"] != null)
            {
                <a class="btn btn-info btn-sm" id="reset" href="~/SalesComm/?&n1_name=@Request.QueryString["n1_name"]">Reset</a>
            }
        }
    </div>
    <section class="comms">
        @{
                        bool empty = false;
                        foreach (var salesComm in Model)
                        {
                            string products = salesComm.sc_products;
                            if (!string.IsNullOrEmpty(products))
                            {
                    empty = false;

                                bool islist = products.Any(m => m.ToString().Contains(","));
                                if (!islist && userProducts.Contains(products))
                                {
                        <div>
                            <h4>
                                <a style="cursor:pointer;" id="@salesComm.scID"><span style="font-size:14px;" id="toggle_@salesComm.scID"></span> @Html.Raw(@salesComm.sc_headline)</a>
                                @if (Request.QueryString["translate"] != null)
                                            {
                                        @Html.ActionLink("T", "Create", "Localization", new { parent_id = salesComm.scID, tableName = "salesComm", columnName = "sc_headline", message = "", n1_name = "Translate Page Content", msg = Request.QueryString["n1_name"], lang = salesComm.default_lang }, htmlAttributes: new { @id = "translate", @class = "glyphicon glyphicon-edit" })
                                }
                            </h4>
                            @Html.ActionLink(salesComm.nav2_longName, actionName: "Index", controllerName: "SalesComm", routeValues: new { parentid = salesComm.n1ID, childid = salesComm.n2ID, n2_name = salesComm.nav2_longName, n3id = salesComm.n3ID, n3_name = salesComm.nav3_longName, n1_name = Request.QueryString["n1_name"] }, htmlAttributes: null)
                            <font style="color:#E50043;">&rArr;</font> @Html.ActionLink(salesComm.nav3_longName, actionName: "Index", controllerName: "SalesComm", routeValues: new { parentid = salesComm.n1ID, childid = salesComm.n2ID, n2_name = salesComm.nav2_longName, n3id = salesComm.n3ID, n3_name = salesComm.nav3_longName, n1_name = Request.QueryString["n1_name"] }, htmlAttributes: null)
                            <br />
                            <div style="line-height:30px;" class="subtext" id="sc_teaser_@salesComm.scID">
                                @Html.Raw(salesComm.sc_teaser)
                                @if (Request.QueryString["translate"] != null)
                    {
                        @Html.ActionLink("T", "Create", "Localization", new { parent_id = salesComm.scID, tableName = "salesComm", columnName = "sc_teaser", message = "", n1_name = "Translate Page Content", msg = Request.QueryString["n1_name"], lang = salesComm.default_lang }, htmlAttributes: new { @id = "translate", @class = "glyphicon glyphicon-edit" })
                                }
                                <br />
                                @String.Format("{0:d}", @salesComm.sc_startDate) <br />
                                <a class="salesComm_more  btn btn-primary" id="@salesComm.scID">More</a>
                            </div>
                            <div id="sc_body_@salesComm.scID" class="show_sales_comm">
                                @Html.Raw(salesComm.sc_body)
                                @if (Request.QueryString["translate"] != null)
                    {
                        @Html.ActionLink("T", "Create", "Localization", new { parent_id = salesComm.scID, tableName = "salesComm", columnName = "sc_body", message = "", n1_name = "Translate Page Content", msg = Request.QueryString["n1_name"], lang = salesComm.default_lang }, htmlAttributes: new { @id = "translate", @class = "glyphicon glyphicon-edit" })
                                }
                    @if (@salesComm.list_attachments.Count() != 0)
                    {
                                    <h4><u>Attached RiSources</u></h4>
                                    foreach (var items in salesComm.list_attachments)
                        {
                            Uri uriResult;
                            bool result = Uri.TryCreate(items.img, UriKind.Absolute, out uriResult)
                            && (uriResult.Scheme == Uri.UriSchemeHttp
                            || uriResult.Scheme == Uri.UriSchemeHttps);

                            if (result)
                            {
                                            <div>
                                                @items.name -
                                                <a id="@ViewBag.file_size" target="_blank" href="@items.img" class="btn btn-primary btn-sm glyphicon glyphicon-new-window"> Link</a>
                                            </div>
                                        }
                                        else
                                        {
                                            <div>
                                                @items.name -
                                                <a id="@ViewBag.file_size" href="~/attachments/risources/@items.img" class="btn btn-primary btn-sm glyphicon glyphicon-download-alt" target="_blank"> Download</a>
                                            </div>
                                        }
                                    }
                                }
                            </div>
                        </div>
                        continue;
                    }
                    else
                    {
                        var prod = userProducts.ToArray();

                        foreach (var item in prod)
                        {

                            if (salesComm.sc_products.Contains(@item.ToString()))
                            {
                                    <div>
                                        <h4>
                                            <span style="font-size:14px;" id="toggle_@salesComm.scID"></span> <a style="cursor:pointer;" id="@salesComm.scID">@Html.Raw(salesComm.sc_headline)</a>
                                            @if (Request.QueryString["translate"] != null)
            {
                @Html.ActionLink("T", "Create", "Localization", new { parent_id = salesComm.scID, tableName = "salesComm", columnName = "sc_headline", message = "", n1_name = "Translate Page Content", msg = Request.QueryString["n1_name"], lang = salesComm.default_lang }, htmlAttributes: new { @id = "translate", @class = "glyphicon glyphicon-edit" })
                                            }
                                        </h4>
                                        @Html.ActionLink(salesComm.nav2_longName, actionName: "Index", controllerName: "SalesComm", routeValues: new { parentid = salesComm.n1ID, childid = salesComm.n2ID, n2_name = salesComm.nav2_longName, n3id = salesComm.n3ID, n3_name = salesComm.nav3_longName, n1_name = Request.QueryString["n1_name"] }, htmlAttributes: null)
                                        <font style="color:#E50043;">&rArr;</font> @Html.ActionLink(salesComm.nav3_longName, actionName: "Index", controllerName: "SalesComm", routeValues: new { parentid = salesComm.n1ID, childid = salesComm.n2ID, n2_name = salesComm.nav2_longName, n3id = salesComm.n3ID, n3_name = salesComm.nav3_longName, n1_name = Request.QueryString["n1_name"] }, htmlAttributes: null)
                                        <br />
                                        <div style="line-height:30px;" class="subtext" id="sc_teaser_@salesComm.scID">
                                            @Html.Raw(salesComm.sc_teaser)
                                            @if (Request.QueryString["translate"] != null)
            {
                @Html.ActionLink("T", "Create", "Localization", new { parent_id = salesComm.scID, tableName = "salesComm", columnName = "sc_teaser", message = "", n1_name = "Translate Page Content", msg = Request.QueryString["n1_name"], lang = salesComm.default_lang }, htmlAttributes: new { @id = "translate", @class = "glyphicon glyphicon-edit" })
                                            }
                                            <br />
                                            @String.Format("{0:d}", @salesComm.sc_startDate)
                                            <br />
                                            <a class="salesComm_more btn btn-primary" id="@salesComm.scID">More</a>
                                        </div>
                                        <div id="sc_body_@salesComm.scID" class="show_sales_comm">
                                            @Html.Raw(salesComm.sc_body)
                                            @if (Request.QueryString["translate"] != null)
            {
                @Html.ActionLink("T", "Create", "Localization", new { parent_id = salesComm.scID, tableName = "salesComm", columnName = "sc_body", message = "", n1_name = "Translate Page Content", msg = Request.QueryString["n1_name"], lang = salesComm.default_lang }, htmlAttributes: new { @id = "translate", @class = "glyphicon glyphicon-edit" })
                                            }
            @if (@salesComm.list_attachments.Count() != 0)
            {
                                                <h4><u>Attached RiSources</u></h4>
                                                foreach (var items in salesComm.list_attachments)
                {
                    Uri uriResult;
                    bool result = Uri.TryCreate(items.img, UriKind.Absolute, out uriResult)
                    && (uriResult.Scheme == Uri.UriSchemeHttp
                    || uriResult.Scheme == Uri.UriSchemeHttps);

                    if (result)
                    {
                                                        <div>
                                                            @items.name -
                                                            <a id="@ViewBag.file_size" target="_blank" href="@items.img" class="btn btn-primary btn-sm glyphicon glyphicon-new-window"> Link</a>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div>
                                                            @items.name -
                                                            <a id="@ViewBag.file_size" href="~/attachments/risources/@items.img" class="btn btn-primary btn-sm glyphicon glyphicon-download-alt" target="_blank"> Download</a>
                                                        </div>
                                                    }
                                                }
                                            }
                                        </div>
                                    </div>
                                break;
                            }

                        }

                    }

                }
                else
                {
                    empty = true;
                }
            }

            if (empty)
            {
                                    <div class="text-center">No communication record found for the current year.</div>
            }
            }

        </section>
</div>
